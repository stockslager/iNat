<!DOCTYPE html>  
<html lang="en">    
 
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />    
<meta name="viewport" content="width=device-width, minimum-scale=1.0" /> 
<meta name="description" content="Garden Viewer" />
<link rel="icon" type="image/png" href="plant-icon-96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="plant-icon-96.svg" />
<link rel="shortcut icon" href="plant-club.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="plant-icon-192.png" />
<meta name="apple-mobile-web-app-title" content="Garden Visitors" />
<link rel="manifest" href="plant_club.webmanifest" />
<link rel="stylesheet" type="text/css" href="seed_library.css" />
<script type="text/javascript" src='common_func.js'> </script>
<title>Garden Viewer</title>
</head>

<style>
   #tablekey { margin-left:15px; display:inline-table; justify-content:start; padding-top: 4px; padding-bottom: 4px; padding-left: 4px; padding-right: 4px; }
   #trkey { padding:0; background:var(--color-base); border:none; border-collapse:collapse; }
   #tdkey { padding:0; padding-right: 25px; }
</style>
 
<body>
<script>
let winurlstr = window.location.href;
let winurlsearchstr = window.location.search;
let winurlexsearchstr = winurlstr.replace(winurlsearchstr,'');
let winurlparams  = new URLSearchParams(winurlsearchstr.substring(1));
let p_params      = winurlparams.get('params') || '';
let p_field       = winurlparams.get('field') || '';
let configuration = '';

</script> 
<script src="https://cdn.jsdelivr.net/gh/stockslager/inat/library_params_v9.js"></script>
<script> 
 
function buildMenu(data) {
      let menu_string = '';
      let links = '';
      configuration = data.configurations[0];
 
      menu_string = '<div class="navbar">';
      if( configuration.plant_project )      { links += furl(github_root+'plant_about.html?params='+p_params+'&field=plant_project',      "plant_project"); }
      if( configuration.observers_project )  { links += furl(github_root+'plant_about.html?params='+p_params+'&field=observers_project',  "observers_project"); }
      if( configuration.insect_project )     { links += furl(github_root+'plant_about.html?params='+p_params+'&field=insect_project',     "insect_project"); }
      if( configuration.title )              { links += furl(github_root+'plant_about.html?params='+p_params+'&field=title',              "title"); }
      if( configuration.plant_filter )       { links += furl(github_root+'plant_about.html?params='+p_params+'&field=plant_filter',       "plant_filter"); }
      if( configuration.plant_filter_value ) { links += furl(github_root+'plant_about.html?params='+p_params+'&field=plant_filter_value', "plant_filter_value"); }
      if( configuration.plant_ids )          { links += furl(github_root+'plant_about.html?params='+p_params+'&field=plant_ids',          "plant_ids"); }
      if( configuration.default_place )      { links += furl(github_root+'plant_about.html?params='+p_params+'&field=default_place',      "default_place"); }
      if( configuration.show_behavior )      { links += furl(github_root+'plant_about.html?params='+p_params+'&field=show_behavior',      "show_behavior"); }
      if( configuration.field_id )           { links += furl(github_root+'plant_about.html?params='+p_params+'&field=field_id',           "field_id"); }
      if( configuration.field_name )         { links += furl(github_root+'plant_about.html?params='+p_params+'&field=field_name',         "field_name"); }
      menu_string += buildDD('Parameters', links);
 
      menu_string += buildHome(furl(github_root+'plant_dashboard.html?params='+p_params,'&#127807;'));

      menu_string += '</div>';

      faddelem('p',document.body,{innerHTML:(menu_string)});  
}

function displayJson(data) {

    let def_place_no_prj = '';
    if( !configuration.plant_project ) {
        def_place_no_prj = '  Default place is also used (as in this case) when plant_ids are configured but no plant_project is set.';
    }
 
    faddelem('p',document.body,{innerHTML:('This app is driven by a configuration file stored in '+p_params+'.json.  '+
                                           'This configuration file tells the app things like which projects to pull data '+
                                           'from and which observation fields to filter that data with.<br>')});
                                           
    if( p_field === 'plant_project' ) {
        faddelem('p',document.body,{innerHTML:('<hr><b>plant_project: '+furl(root_projects+configuration.plant_project, configuration.plant_project)+'</b><br><br>' +
                                               'The unique iNat project id for the project that contains the plant observations. <hr>')});
    } else if( p_field === 'observers_project' ) {
        faddelem('p',document.body,{innerHTML:('<hr><b>observers_project: '+furl(root_projects+configuration.observers_project, configuration.observers_project)+'</b><br><br>' +
                                               'The unique iNat project id for the project that defines the network of observers contributing ' +
                                               'wildlife observations for display by the app. <hr>')});
    } else if( p_field === 'insect_project' ) {
        faddelem('p',document.body,{innerHTML:('<hr><b>insect_project: '+furl(root_projects+configuration.insect_project, configuration.insect_project)+'</b><br><br>' +
                                               'The unique iNat project id for the project that contains the insect and ' +
                                               'other wildlife activity observations. The wildlife activity observations in ' +
                                               'this project are sometimes further filtered by setting the default_place parameter.<hr>')});
    } else if( p_field === 'title' ) {
        faddelem('p',document.body,{innerHTML:('<hr><b>title:</b><br><br>The title to be displayed above the plant list in the app.<hr>')});
    } else if( p_field === 'plant_filter' ) {
        faddelem('p',document.body,{innerHTML:('<hr><b>plant_filter:</b><br><br>Used to filter observations stored in the iNat plant_project in the event that the iNat plant_project contains more than just the observations to be displayed in the plant list.<hr>')});
    } else if( p_field === 'plant_filter_value' ) {
        faddelem('p',document.body,{innerHTML:('<hr><b>plant_filter_value</b><br><br>The value of the "plant_filter" parameter.<hr>')});
    } else if( p_field === 'plant_ids' ) {
        faddelem('p',document.body,{innerHTML:('<hr><b>plant_ids</b><br><br>A comma delimited list of observation ids corresponding to plant observations to be displayed on the plant list.<hr>')});
    } else if( p_field === 'default_place' ) {
        faddelem('p',document.body,{innerHTML:('<hr><b>default_place: '+furl(root_places+configuration.default_place, configuration.default_place)+'</b><br><br>' +
                                               'The unique iNat place id for the place that contains the insect and ' +
                                               'other wildlife activity observations. The wildlife activity observations in ' +
                                               'this project are sometimes further filtered by setting the default_place parameter.'+def_place_no_prj+'<hr>')});
    } else if( p_field === 'show_behavior' ) {
        faddelem('p',document.body,{innerHTML:('<b>show_behavior: </b><br>' +
                                               '<table id="tablekey">' +
                                               '<tr id="trkey"><td id="tdkey">on_all</td><td id="tdkey">' +
                                               'Displays a link on the plant list page that shows the wildlife '+
                                               'activity counts for the entire list of plants.  Also triggers a "Behaviors" drop down to appear ' +
                                               'with the wildlife activity counts.</td></tr>' +
                                               '<tr id="trkey"><td id="tdkey">by_plant</td><td id="tdkey">' +
                                               'Triggers a "Behaviors" drop down to appear with the wildlife activity counts for ' +
                                               'each individual plant.</td></tr></table>')});
                                               /*'Valid Values Include <br> ' +
                                               'on_all ~ Displays a link on the plant list page that shows the wildlife '+
                                               'activity counts for the entire list of plants.  Also triggers a "Behaviors" drop down to appear ' +
                                               'with the wildlife activity counts.<br>' +
                                               'by_plant ~ Triggers a "Behaviors" drop down to appear with the wildlife activity counts for ' +
                                               'each individual plant. <hr>')});*/
    } else if( p_field === 'field_id' ) {
        faddelem('p',document.body,{innerHTML:('<hr><b>field_id: '+furl(root_obs_fields+configuration.field_id, configuration.field_id)+'</b><br><br>' +
                                               'The unique iNat field id for the observation field used to associate an ' +
                                               'observation of wildlife to a given plant. <hr>')});
    } else if( p_field === 'field_name' ) {
        faddelem('p',document.body,{innerHTML:('<hr><b>field_name: '+furl(root_obs_fields+configuration.field_id, configuration.field_name)+'</b><br><br>' +
                                               'The unique iNat field name for the observation field used to associate an ' +
                                               'observation of wildlife to a given plant. <hr>')});
    }  
    const prettyJson = JSON.stringify(data, null, 2);
    faddelem('p',document.body,{innerHTML:('<br><b>Entire '+p_params+'.json:</b>' +
                                           '<pre id="json-display"></pre>')});
    document.getElementById('json-display').textContent = prettyJson;

}
  
fetch((p_params+'.json'))
     .then(response => response.json())
     .then(data => {
      buildMenu(data);
      displayJson(data);
      console.log(data);
   })
     .catch(error => {
      faddelem('p',document.body,{innerText:'There was a problem retrieving '+p_params+'.json.'});
      faddelem('p',document.body,{innerText:'A valid configuration file is required to be specified as a url parameter. (e.g. ?params=bugs_cnc).'});
      throw new Error('Error fetching JSON');
});

</script>
</body>

</html>
